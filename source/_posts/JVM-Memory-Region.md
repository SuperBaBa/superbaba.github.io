---
title: JVM内存区域
date: 2021-07-04 13:48:22
tags: 
  - JVM
  - Java
categories: 
  - Java
---
# JVM内存区域

## 运行时数据区域

定义：JVM在执行Java程序过程中，会将其所管理的内存分为多个区域，同时会有一些**直接内存**不在运行时数据区，但JVM也会使用一些工具对其进行频繁使用。

* 线程私有区

  每一个线程都有一份单独的内存区域，即线程栈。包括虚拟机栈(内含栈帧)、程序计数器
<!--more-->
* 线程共享区

  被所有线程共享，且只有一份，如：方法区、堆内存区域

  ![运行时数据区](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210323152206793.png)

# Java方法和虚拟机栈

* 虚拟机栈

  虚拟机栈的生命周期和线程生命周期是一样的，虚拟机栈默认大小为`1M`，可用参数`-Xss`调整大小

  **数据结构**：是先进先出的数据结构

  **作用**：存储当前线程运行方法所需的数据(`局部变量`)，指令、返回地址

* 栈帧

  在每个Java方法被调用是，都会创建一个栈帧，并入栈，完成调用则出栈，栈帧大体包含所含区域：**局部变量表**、**操作数栈**、**动态连接**、**返回地址**。

  - 局部变量表

  - 操作数栈

  - 动态连接

    动态分派，多见于方法重写使其具有多态性，重写时使用`invokevirtual`指令，器解析过程如下

    1. 找到操作数栈第一个元素所指向的对象实际类型，记做A
    2. 

  - 返回地址

* 程序计数器

* 栈帧与内存区域

  使用`javap -c XXXX.class`对class文件进行反汇编，[字节码助记地址](https://cloud.tencent.com/developer/article/1333540)

  ![image-20210323153430793](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20210323153430793.png)





